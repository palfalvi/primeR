---
title: "Creating SQLite database from csv file of primers"
output: html_notebook
---

```{r}
library(RSQLite)
library(tidyverse)
library(dbplyr)
```


Proper columns in future:
- id (primary key?, autoincrement)
- primer_name
- sequence
- concentration
- name #who ordered
- date
- comments
- empty #TRUE/FALSE

```{r open_csv}
all_primers <- read_csv("/home/peegee/primeR/primers.csv", col_names = c("id", 
                                                     "primer_name", 
                                                     "sequence", 
                                                     "concentration"), 
                        skip = 1, trim_ws = TRUE, na = "NA") %>%
  mutate(concentration = ifelse(is.na(concentration), yes = 0, no = concentration),
         name = "Nobody",
         date = lubridate::today(),
         comments = " ",
         empty = TRUE) %>%
  select(id,
         primer_name,
         sequence,
         concentration,
         comments,
         date,
         name,
         empty
         )

all_primers <-
  all_primers %>% 
  anti_join(all_primers[duplicated(all_primers$id),] )
```

```{r connect}
con <- dbConnect(SQLite(), "./../../primers.sqlite")
```

```{r overwrite}
#Delete table
#dbRemoveTable(con, "primers")


dbGetQuery(con, "CREATE TABLE primers
(
  id INTEGER PRIMARY KEY, -- Autoincrement
  primer_name TEXT,
  sequence TEXT,
  concentration REAL,
  comments TEXT,
  date TEXT,
  name TEXT,
  empty INTEGER
)")

# dbWriteTable(con, 
#              name="primers", 
#              value = all_primers, 
#              overwrite = TRUE)

dbWriteTable(con, "primers", all_primers, append = TRUE)
```

```{r check}
dbGetQuery(con, "SELECT * FROM primers LIMIT 5;")
```


```{r disconnect}
dbDisconnect(con)
```